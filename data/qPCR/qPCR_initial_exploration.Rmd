---
title: "qPCR_initial_exploration"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE}
library(ggplot2)

rm(list=ls())

load(file="../Coralphoto__Metadata/KI_Platy_metadataSH.RData")

metadata.SH$dom <- ifelse(metadata.SH$C.PaxC > metadata.SH$D.PaxC,"C","D")

metadata.SH$S.H.log <- log(metadata.SH$S.H)

metadata.SH$field_season[which(metadata.SH$field_season=="KI2015a_Pre")] <- "KI2015a"
# But then collapse field seasons into before/during/after
metadata.SH$before.after <- metadata.SH$field_season
metadata.SH$before.after <- gsub("KI2014","before",metadata.SH$before.after)
metadata.SH$before.after <- gsub("KI2015a","before",metadata.SH$before.after)
metadata.SH$before.after <- gsub("KI2015b","before",metadata.SH$before.after)
metadata.SH$before.after <- gsub("KI2015c","during",metadata.SH$before.after)
metadata.SH$before.after <- gsub("KI2016a","after",metadata.SH$before.after)
metadata.SH$before.after <- gsub("KI2016b","recovery1",metadata.SH$before.after)
metadata.SH$before.after <- gsub("KI2017a","recovery2",metadata.SH$before.after)
metadata.SH$bleaching_proportion <- gsub("NONE","FALSE",metadata.SH$bleaching_proportion)
metadata.SH$bleaching_proportion <- gsub("1","FALSE",metadata.SH$bleaching_proportion)
metadata.SH$bleaching_proportion <- gsub("2","2",metadata.SH$bleaching_proportion)
metadata.SH$bleaching_proportion <- gsub("3","3",metadata.SH$bleaching_proportion)
metadata.SH$bleaching_proportion <- gsub(" ","",metadata.SH$bleaching_proportion)

metadata.SH.FQ <- metadata.SH[grepl("FQ", metadata.SH$Sample.Name),]
metadata.SH.noFQ <- metadata.SH[!grepl("FQ", metadata.SH$Sample.Name),]


ggplot(aes(y = S.H.log, x = field_season), data = metadata.SH.noFQ) + geom_boxplot()
# ggplot(aes(y = S.H.log, x = before.after), data = metadata.SH.noFQ) + geom_boxplot()

ggplot(aes(y = S.H.log, x = field_season,color=dom), data = metadata.SH.noFQ) + geom_boxplot() + facet_wrap(~Status)

ggplot(aes(y = S.H.log, x = field_season,color=dom), data = metadata.SH.noFQ) + geom_point() + facet_wrap(~Status)


ggplot(aes(y = S.H.log, x = before.after,color=bleaching_proportion), data = metadata.SH.noFQ) + geom_point()

metadata.SH$bleaching_proportion <- gsub(" ","",metadata.SH$bleaching_proportion)

metadata.SH$bleaching2Plus <- metadata.SH$bleaching_proportion
metadata.SH$bleaching2Plus <- gsub("NONE","FALSE",metadata.SH$bleaching2Plus)
metadata.SH$bleaching2Plus <- gsub("1","FALSE",metadata.SH$bleaching2Plus)
metadata.SH$bleaching2Plus <- gsub("2","2",metadata.SH$bleaching2Plus)
metadata.SH$bleaching2Plus <- gsub("3","3",metadata.SH$bleaching2Plus)
metadata.SH$bleaching2Plus <- gsub(" ","",metadata.SH$bleaching2Plus)

ggplot(aes(y = S.H.log, x = bleaching_proportion,color=before.after), data = metadata.SH.noFQ) + geom_point()

ggplot(aes(y = S.H.log, x = bleaching_proportion,color=before.after), data = metadata.SH.noFQ) + geom_point()

hist(metadata.SH$S.H,breaks = 100)

metadata.SH.noFQ$date <- as.POSIXct("2010-01-01 00:00:00",tz="Pacific/Kiritimati", format="%Y-%m-%d %H:%M:%S")
metadata.SH.noFQ$date[which(metadata.SH.noFQ$field_season=="KI2014")] <- as.POSIXct("2014-09-01 00:00:00",tz="Pacific/Kiritimati", format="%Y-%m-%d %H:%M:%S")
metadata.SH.noFQ$date[which(metadata.SH.noFQ$field_season=="KI2015a")] <- as.POSIXct("2015-01-20 00:00:00",tz="Pacific/Kiritimati", format="%Y-%m-%d %H:%M:%S")
metadata.SH.noFQ$date[which(metadata.SH.noFQ$field_season=="KI2015b")] <- as.POSIXct("2015-05-10 00:00:00",tz="Pacific/Kiritimati", format="%Y-%m-%d %H:%M:%S")
metadata.SH.noFQ$date[which(metadata.SH.noFQ$field_season=="KI2015c")] <- as.POSIXct("2015-07-25 00:00:00",tz="Pacific/Kiritimati", format="%Y-%m-%d %H:%M:%S")
metadata.SH.noFQ$date[which(metadata.SH.noFQ$field_season=="KI2016a")] <- as.POSIXct("2016-03-25 00:00:00",tz="Pacific/Kiritimati", format="%Y-%m-%d %H:%M:%S")
metadata.SH.noFQ$date[which(metadata.SH.noFQ$field_season=="KI2016b")] <- as.POSIXct("2016-11-08 00:00:00",tz="Pacific/Kiritimati", format="%Y-%m-%d %H:%M:%S")
metadata.SH.noFQ$date[which(metadata.SH.noFQ$field_season=="KI2017a")] <- as.POSIXct("2017-07-15 00:00:00",tz="Pacific/Kiritimati", format="%Y-%m-%d %H:%M:%S")

ggplot(aes(y = S.H.log, x = date), data = metadata.SH.noFQ) + scale_x_datetime() + geom_smooth() + ggtitle("Symbiont:Host Ratio")

ggplot(aes(y = S.H.log, x = date,color=dom), data = metadata.SH.noFQ) + geom_smooth() + facet_wrap(~Status) + ggtitle("Symbiont:Host Ratio")


metadata.SH.AD <- metadata.SH[which(metadata.SH$Status != "UK" & metadata.SH$Status != "gone" & metadata.SH$Status != "dead_or_gone"),]
```

